<!doctype html>
<html>
  <head>
    <title>Tanks tester</title>
    <script src="js/graphics/Scene.js"></script>
    <script src="js/graphics/MovingObject.js"></script>
  </head>
  <body>
	<canvas id="the-canvas" width="500" height="500"></canvas>
	<script>
		/* Do Dependencie injections */
		Scene.prototype.setTimeout = function(callback, timeout) {
			return window.setTimeout(callback, timeout);
		};
		Scene.prototype.setInterval = function(callback, interval) {
			return window.setInterval(callback, interval);
		};
		Scene.prototype.clearTimeout = function(timeoutId) {
			return window.clearTimeout(timeoutId);
		};
		Scene.prototype.clearInterval = function(intervalId) {
			return window.clearInterval(intervalId);
		};
		
		MovingObject.prototype.Math.cos = function(angle) {
			return Math.cos(angle);
		};
		MovingObject.prototype.Math.sin = function(angle) {
			return Math.sin(angle);
		};
		
		var canvas = document.getElementById('the-canvas');
		var scene = new Scene();
		scene.setCanvas(canvas);
		var c1 = document.createElement('canvas');
		c1.width = 100;
		c1.height = 100;
		var ctc1 = c1.getContext('2d');
		ctc1.fillStyle = '#00ff00';
		ctc1.fillRect(0, 0, 500, 500);
		var o1 = new MovingObject();
		o1.getImageCallback = function() {
			return c1;
		};
		o1.config = {
			speed: 0.1,
			rotSpeed: 0.001
		};
		o1.width = c1.height;
		o1.height = c1.height;
		
		
		c2 = document.createElement('canvas');
		c2.height = 100;
		c2.width = 100;
		var ctc2 = c2.getContext('2d');
		ctc2.fillStyle = '#0000ff';
		ctc2.fillRect(0, 0, 100, 100);
		var o2 = new MovingObject();
		o2.getImageCallback = function() {
			return c2;
		};
		o2.width = c2.width;
		o2.height = c2.height;
		o2.x = 400;
		o2.y = 100;
		
		scene.addDrawObject(o1);
		scene.addDrawObject(o2);
		scene.start();
		//setTimeout(function() {scene.stop();}, 3100); 
		
		document.onkeydown = function(event) {
			switch(event.keyCode) {
				case 37: // left
					o1.rotateLeft();
				break;
				case 38: // up
					o1.moveForward();
				break;
				case 39: // right
					o1.rotateRight();
				break;
				case 40: // down
					o1.moveBackwards();
				break;
			}
			if([37, 38, 39, 40].indexOf(event.keyCode) > -1) {
				event.preventDefault();
			}
		};
		
		document.onkeyup = function(event) {
			if(event.keyCode === 37 || event.keyCode === 39) {
				o1.stopRotating();
			} else if(event.keyCode === 38 || event.keyCode === 40) {
				o1.stopMoving();
			}
			if([37, 38, 39, 40].indexOf(event.keyCode) > -1) {
				event.preventDefault();
			}
		};
	</script>
  </body>
</html>